<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebGl  二维纹理贴图(矩形)</title>
</head>
<body>

<canvas id="myCanvas" width="500" height="300" style='border:1px solid red'></canvas>

</body>

<script>

    window.onload = function () {

        //获取上下文
        var canvas = document.getElementById('myCanvas');
        var gl = canvas.getContext('webgl');

        //定义矩形数据 并 将其储存在缓存对象
        var vertices = [
            -0.5,0.5,0.0,    0.0,0.0,//(x,y,z)(r,g,b)分别代表坐标和颜色
            -0.5,-0.5,0.0,   1.0,0.0,
            0.5,-0.5,0.0,    0.0,1.0,
            0.5,0.5,0.0,     1.0,1.0,
        ];

        var indices = [3,2,1,3,1,0];

        var vertex_buffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER,vertex_buffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);

        var Index_Buffer = gl.createBuffer();
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,Index_Buffer);//注意  是  ELEMENT_ARRAY_BUFFER  不是  ARRAY_BUFFER
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices), gl.STATIC_DRAW);

        //创建和编译着色器程序
        var vertCode = 'attribute vec3 coordinates;' +
            'attribute vec2 texCoord;' +
            'varying vec2 vtexCoord;' +
            'void main() {' +
            '   gl_Position = vec4(coordinates, 1.0);' +
            '   vtexCoord = texCoord;' +
            '}';
        var fragCode = 'precision mediump float;' +
            'varying vec2 vtexCoord;' +
            'uniform sampler2D u_Sampler;' +
            'void main() {' +
            '   gl_FragColor = texture2D(u_Sampler, vtexCoord);' +
            '}';

        var vertShader = gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vertShader, vertCode);
        gl.compileShader(vertShader);

        var fragShader = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fragShader, fragCode);
        gl.compileShader(fragShader);

        var shaderProgram = gl.createProgram();
        gl.attachShader(shaderProgram, vertShader);
        gl.attachShader(shaderProgram, fragShader);
        gl.linkProgram(shaderProgram);
        gl.useProgram(shaderProgram);


        //与缓冲区对象相关联着色器程序
        var bytes = new Float32Array(vertices).BYTES_PER_ELEMENT;// vertices中每个元素的字节数 ,这里是 float 类型, 所以是 4 个字节

        var coord = gl.getAttribLocation(shaderProgram, "coordinates");
        gl.vertexAttribPointer(coord, 3, gl.FLOAT, false, bytes*5, 0);
        gl.enableVertexAttribArray(coord);

        var texCoord = gl.getAttribLocation(shaderProgram, "texCoord");
        gl.vertexAttribPointer(texCoord, 2, gl.FLOAT, false, bytes*5, bytes*3) ;
        gl.enableVertexAttribArray(texCoord);


        //创建纹理对象并调用纹理绘制方法
        var texture = gl.createTexture();//创建纹理对象
        var u_Sampler = gl.getUniformLocation(shaderProgram,"u_Sampler");//获取u_Sampler的存储位置
        var image = new Image();//创建image对象
        image.src = "/img/1.png";
        image.onload = function () {//加载纹理
            //纹理绘制
            gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,1);//对纹理图像进行y轴反转
            gl.activeTexture(gl.TEXTURE0);//开启0号纹理单元
            gl.bindTexture(gl.TEXTURE_2D,texture);//向target绑定纹理对象
            gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);//配置纹理参数
            gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,gl.RGB,gl.UNSIGNED_BYTE,image);//配置纹理图像
            gl.uniform1i(u_Sampler,0);//将0号纹理传递给着色器

            //绘制
            gl.clearColor(0.0,0.0,0.0,1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);
            gl.drawElements(gl.TRIANGLE_STRIP, indices.length, gl.UNSIGNED_SHORT,0);

        };


    }

</script>

</html>